---
title: "Martino"
author: "Martino Armanini"
date: "26/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# load libraries
library(tidyverse)
library(vroom)
library(janitor)
library(sf)
library(here)
library(extrafont)
library(ggtext)
library(lubridate)
library(urbnmapr)
library(readxl)
library(stringr)
library(ggnewscale)
library(gganimate)
library(animation)
library(transformr)
library(skimr)

loadfonts(device="win")
```

```{r}
# load "firsts" data and clean column names
firsts <- read_csv(here("../data/firsts_augmented.csv")) %>% 
  clean_names()
```
# Glimpse and Skim the data
```{r}
glimpse(firsts)

skim(firsts)

```

From this first analysis we see we're having quite a significant amount of missing values.

Let's load the other data set before modifying anything from here

#Loading population

```{r}
# load population data from 1790-2010 and clean names
# source: https://conservancy.umn.edu/handle/11299/181605
pop <- read_xlsx(here("../data/county2010_hist_pops.xlsx"), sheet = "c2010_hist_pops") %>% 
  clean_names()

```

Data Discovery

## Most firsts per state and distribution of firts
```{r}

states <- firsts %>% 
  filter(!is.na(state)) %>% 
  count(state) %>% 
  mutate(tot  = sum(n), pct = n/sum(n)) %>% 
  arrange(desc(n))

ggplot(states, aes(n)) + 
  geom_histogram()

ggplot(states, aes(x = n, y = reorder(state, n))) +
  geom_col() +
  theme_classic()

```

Interesting stuff, we can see that there is a stark difference between state 36 (New York State) and state 27(Minnesota) we'll see later how these developed over time! (Why is Mexico in there?)

## Gender and Category analysis

```{r}
## Gender count
gender <- firsts %>% 
  filter(!is.na(gender)) %>% 
  count(gender) %>% 
  mutate(tot = sum(n), pct = n/tot) %>% 
  arrange(desc(n))

ggplot(gender, aes(x = gender, y = n)) +
  geom_col() +
  theme_classic()
# ADD PERCENTAGES

## Category count
category <- firsts %>% 
  filter(!is.na(category)) %>% 
  count(category) %>% 
  mutate(tot = sum(n), pct = n/tot) %>% 
  arrange(desc(n))

ggplot(category, aes(x = n, y = reorder(category, -n))) +
  geom_col() +
  theme_classic()
# ADD PERCENTAGES


```

# Time series
```{r}
#Changing the format of year column
firsts$year  <- as.Date(as.character(firsts$year), "%Y")
firsts$year <- year(firsts$year)



str(firsts)

#date_test <- c_d_clean %>% 
#  mutate(day1 = day(date_rep))





```

